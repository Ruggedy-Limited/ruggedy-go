<?php

use App\Utils\RawMigration;

class AddVulnerabilityColumnsForNexpose extends RawMigration
{
    /**
     * @inheritdoc
     *
     * @return string
     */
    function getRawSqlMigration()
    {
        return <<<SQL
SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

ALTER TABLE `vulnerabilities` 
ADD COLUMN `id_from_scanner` VARCHAR(100) NULL DEFAULT NULL COMMENT '' AFTER `id`,
CHANGE COLUMN `severity` `severity` INT(2) NULL DEFAULT NULL COMMENT '', 
ADD COLUMN `pci_severity` INT(2) NULL DEFAULT NULL COMMENT '' AFTER `severity`,
ADD COLUMN `exploit_description` VARCHAR(255) NULL DEFAULT NULL COMMENT '' AFTER `exploit_available`,
ADD COLUMN `malware_available` TINYINT(1) UNSIGNED NULL DEFAULT NULL COMMENT '' AFTER `exploit_description`,
ADD COLUMN `malware_description` VARCHAR(255) NULL DEFAULT NULL COMMENT '' AFTER `malware_available`,
ADD COLUMN `published_date_from_scanner` DATETIME NULL DEFAULT NULL COMMENT '' AFTER `http_attack_response`,
ADD COLUMN `modified_date_from_scanner` DATETIME NULL DEFAULT NULL COMMENT '' AFTER `published_date_from_scanner`;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
SQL;
    }

}
